@model FullstackMVC.Models.Course

@{
    ViewData["Title"] = "Course Details";
}

<div class="container-fluid mt-4">
    <div class="row">
 <div class="col-12">
   <div class="card shadow">
     <div class="card-header bg-info text-white">
      <div class="d-flex justify-content-between align-items-center">
     <div>
       <h2 class="mb-0">
   <i class="bi bi-book-half"></i> @Model.Name
   </h2>
      <p class="mb-0">Course #@Model.Num | Department: @Model.Department?.Name</p>
       </div>
       <div>
 <a asp-action="EditCourse" asp-route-id="@Model.Num" class="btn btn-warning">
      <i class="bi bi-pencil"></i> Edit Course
  </a>
     </div>
    </div>
   </div>
       <div class="card-body">
<!-- Course Information -->
   <div class="row mb-4">
  <div class="col-md-8">
  <div class="card h-100">
    <div class="card-header">
  <h5 class="mb-0"><i class="bi bi-info-circle"></i> Course Information</h5>
        </div>
      <div class="card-body">
       <div class="row">
     <div class="col-md-6">
    <p><strong>Course Number:</strong> @Model.Num</p>
      <p><strong>Course Name:</strong> @Model.Name</p>
     <p><strong>Topic:</strong> @(Model.Topic ?? "Not specified")</p>
      <p><strong>Department:</strong> @Model.Department?.Name</p>
      </div>
      <div class="col-md-6">
   <p><strong>Maximum Grade:</strong> <span class="badge bg-success">@Model.Degree</span></p>
     <p><strong>Minimum Grade:</strong> <span class="badge bg-warning text-dark">@Model.MinDegree</span></p>
   <p><strong>Pass Rate Requirement:</strong> @string.Format("{0:F1}%", (Model.MinDegree / Model.Degree) * 100)</p>
      <p><strong>Instructor:</strong> 
    @if (Model.Instructor != null)
    {
       <span class="badge bg-primary">@Model.Instructor.Name</span>
      }
   else
      {
   <span class="text-muted">Not assigned</span>
     }
      </p>
    </div>
     </div>
    @if (!string.IsNullOrEmpty(Model.Description))
      {
        <div class="mt-3">
      <h6>Description:</h6>
         <p class="text-muted">@Model.Description</p>
       </div>
    }
    </div>
  </div>
    </div>
     <div class="col-md-4">
   <div class="card h-100">
       <div class="card-header">
    <h5 class="mb-0"><i class="bi bi-graph-up"></i> Quick Stats</h5>
   </div>
     <div class="card-body text-center">
    @if (Model.Grades != null && Model.Grades.Any())
 {
     <h3 class="text-primary">@Model.Grades.Count()</h3>
    <p class="text-muted">Enrolled Students</p>
     
       <h3 class="text-success">@Model.Grades.Count(g => g.GradeValue >= Model.MinDegree)</h3>
      <p class="text-muted">Passed Students</p>
        
     <h3 class="text-info">@string.Format("{0:F1}", Model.Grades.Average(g => g.GradeValue))</h3>
  <p class="text-muted">Average Grade</p>
     }
      else
       {
         <h3 class="text-muted">0</h3>
     <p class="text-muted">No students enrolled yet</p>
       }
      </div>
 </div>
     </div>
  </div>

        @if (Model.Grades != null && Model.Grades.Any())
    {
     <!-- Students List -->
    <div class="row mt-4">
      <div class="col-12">
     <div class="card">
       <div class="card-header">
      <h5 class="mb-0"><i class="bi bi-people-fill"></i> Enrolled Students (@Model.Grades.Count())</h5>
     </div>
       <div class="card-body">
     <div class="table-responsive">
     <table class="table table-hover">
 <thead class="table-dark">
    <tr>
      <th>SSN</th>
    <th>Student Name</th>
    <th>Grade</th>
         <th>Percentage</th>
  <th>Status</th>
        <th>Department</th>
     </tr>
     </thead>
   <tbody>
    @foreach (var grade in Model.Grades.OrderByDescending(g => g.GradeValue))
 {
      var percentage = (grade.GradeValue / Model.Degree) * 100;
  var isPassed = grade.GradeValue >= Model.MinDegree;
   
    <tr class="@(isPassed ? "" : "table-warning")">
     <td>@grade.Student?.SSN</td>
     <td>@grade.Student?.Name</td>
   <td>
      <span class="badge @(isPassed ? "bg-success" : "bg-danger") fs-6">
    @grade.GradeValue / @Model.Degree
     </span>
      </td>
    <td>
    <div class="progress" style="height: 20px; min-width: 100px;">
  <div class="progress-bar @(isPassed ? "bg-success" : "bg-danger")" 
   role="progressbar" 
         style="width: @percentage%" 
        aria-valuenow="@percentage" 
    aria-valuemin="0" 
    aria-valuemax="100">
      @string.Format("{0:F1}%", percentage)
   </div>
      </div>
      </td>
 <td>
     @if (isPassed)
      {
        <span class="badge bg-success">
        <i class="bi bi-check-circle"></i> Passed
       </span>
     }
    else
    {
     <span class="badge bg-danger">
   <i class="bi bi-x-circle"></i> Failed
  </span>
   }
      </td>
     <td>@grade.Student?.Department?.Name</td>
      </tr>
 }
      </tbody>
     </table>
    </div>
   </div>
   </div>
     </div>
        </div>

   <!-- Grade Distribution -->
    <div class="row mt-4">
       <div class="col-12">
 <div class="card">
   <div class="card-header">
      <h5 class="mb-0"><i class="bi bi-bar-chart"></i> Grade Distribution</h5>
     </div>
    <div class="card-body">
 <div class="row text-center">
   <div class="col-md-2">
 <h4 class="text-success">@Model.Grades.Count(g => g.GradeValue >= 90)</h4>
    <small class="text-muted">A (90+)</small>
   </div>
     <div class="col-md-2">
  <h4 class="text-info">@Model.Grades.Count(g => g.GradeValue >= 80 && g.GradeValue < 90)</h4>
    <small class="text-muted">B (80-89)</small>
    </div>
    <div class="col-md-2">
      <h4 class="text-warning">@Model.Grades.Count(g => g.GradeValue >= 70 && g.GradeValue < 80)</h4>
     <small class="text-muted">C (70-79)</small>
   </div>
    <div class="col-md-2">
      <h4 class="text-orange">@Model.Grades.Count(g => g.GradeValue >= 60 && g.GradeValue < 70)</h4>
    <small class="text-muted">D (60-69)</small>
      </div>
   <div class="col-md-2">
     <h4 class="text-danger">@Model.Grades.Count(g => g.GradeValue < 60)</h4>
       <small class="text-muted">F (0-59)</small>
    </div>
    <div class="col-md-2">
       <h4 class="text-primary">@string.Format("{0:F1}%", ((double)Model.Grades.Count(g => g.GradeValue >= Model.MinDegree) / Model.Grades.Count()) * 100)</h4>
        <small class="text-muted">Overall Pass Rate</small>
     </div>
  </div>
     </div>
  </div>
 </div>
     </div>
     }
    else
      {
 <!-- No Students Enrolled -->
    <div class="row mt-4">
        <div class="col-12">
        <div class="card">
  <div class="card-body text-center py-5">
       <i class="bi bi-people text-muted" style="font-size: 5rem;"></i>
  <h4 class="text-muted mt-3">No Students Enrolled</h4>
     <p class="text-muted">This course doesn't have any enrolled students yet.</p>
    </div>
     </div>
     </div>
      </div>
   }

      <!-- Quick Actions -->
 <div class="row mt-4">
      <div class="col-12">
       <div class="card">
    <div class="card-header">
     <h5 class="mb-0">Quick Actions</h5>
  </div>
      <div class="card-body">
    <div class="d-flex flex-wrap gap-2">
      <a asp-action="EditCourse" asp-route-id="@Model.Num" class="btn btn-warning">
     <i class="bi bi-pencil"></i> Edit Course
    </a>
     <a asp-action="Courses" class="btn btn-primary">
      <i class="bi bi-list-ul"></i> All Courses
   </a>
     @if (Model.InstructorId.HasValue)
      {
     <a asp-controller="InstructorDashboard" asp-action="CourseStudents" asp-route-courseId="@Model.Num" class="btn btn-info">
     <i class="bi bi-people"></i> Manage Students
     </a>
     }
        @if (Model.Grades == null || !Model.Grades.Any())
     {
     <a asp-action="DeleteCourse" asp-route-id="@Model.Num" 
       class="btn btn-danger"
      onclick="return confirm('Are you sure you want to delete this course?');">
       <i class="bi bi-trash"></i> Delete Course
  </a>
      }
   </div>
  </div>
     </div>
      </div>
  </div>
    </div>
  </div>
     </div>
    </div>
</div>

<style>
.text-orange {
color: #fd7e14 !important;
}
</style>