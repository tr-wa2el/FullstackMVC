@model FullstackMVC.Models.Course

@{
    ViewData["Title"] = "Edit Course";
}

<div class="container mt-5">
    <div class="row justify-content-center">
    <div class="col-md-8">
  <div class="card shadow">
         <div class="card-header bg-warning text-dark">
 <h2 class="mb-0">
     <i class="bi bi-pencil"></i> Edit Course
   </h2>
    <p class="mb-0">Course #@Model.Num: @Model.Name</p>
</div>
<div class="card-body">
       <form asp-action="EditCourse" method="post">
    <input type="hidden" asp-for="Num" />
   
       <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

   <div class="row">
       <div class="col-md-6 mb-3">
      <label class="form-label">Course Number</label>
       <input type="text" class="form-control" value="@Model.Num" readonly />
   <small class="form-text text-muted">Course number cannot be changed</small>
   </div>
     <div class="col-md-6 mb-3">
      <label asp-for="Name" class="form-label">Course Name</label>
    <input asp-for="Name" class="form-control" />
     <span asp-validation-for="Name" class="text-danger"></span>
     </div>
    </div>

     <div class="row">
     <div class="col-md-6 mb-3">
    <label asp-for="Topic" class="form-label">Course Topic</label>
      <input asp-for="Topic" class="form-control" />
     <span asp-validation-for="Topic" class="text-danger"></span>
    </div>
   <div class="col-md-6 mb-3">
      <label asp-for="DeptId" class="form-label">Department</label>
   <select asp-for="DeptId" class="form-select" asp-items="ViewBag.Departments">
       <option value="">-- Select Department --</option>
      </select>
     <span asp-validation-for="DeptId" class="text-danger"></span>
   </div>
     </div>

     <div class="row">
       <div class="col-md-4 mb-3">
    <label asp-for="Degree" class="form-label">Maximum Degree</label>
      <input asp-for="Degree" class="form-control" type="number" min="1" max="1000" />
       <span asp-validation-for="Degree" class="text-danger"></span>
     </div>
    <div class="col-md-4 mb-3">
   <label asp-for="MinDegree" class="form-label">Minimum Passing Degree</label>
    <input asp-for="MinDegree" class="form-control" type="number" min="1" />
<span asp-validation-for="MinDegree" class="text-danger"></span>
      </div>
         <div class="col-md-4 mb-3">
       <label asp-for="InstructorId" class="form-label">Instructor</label>
     <select asp-for="InstructorId" class="form-select" asp-items="ViewBag.Instructors">
       <option value="">-- No Instructor Assigned --</option>
       </select>
        <span asp-validation-for="InstructorId" class="text-danger"></span>
    </div>
    </div>

        <div class="mb-3">
        <label asp-for="Description" class="form-label">Course Description</label>
  <textarea asp-for="Description" class="form-control" rows="4"></textarea>
      <span asp-validation-for="Description" class="text-danger"></span>
     </div>

       <!-- Course Statistics (if has students) -->
       @if (Model.Grades != null && Model.Grades.Any())
       {
  <div class="mb-4">
      <div class="card bg-light">
 <div class="card-header">
    <h6 class="mb-0">Current Course Statistics</h6>
   </div>
    <div class="card-body">
      <div class="row text-center">
    <div class="col-md-3">
        <h5 class="text-primary">@Model.Grades.Count()</h5>
     <small class="text-muted">Enrolled Students</small>
     </div>
  <div class="col-md-3">
  <h5 class="text-success">@Model.Grades.Count(g => g.GradeValue >= Model.MinDegree)</h5>
        <small class="text-muted">Passed</small>
       </div>
<div class="col-md-3">
 <h5 class="text-danger">@Model.Grades.Count(g => g.GradeValue < Model.MinDegree)</h5>
         <small class="text-muted">Failed</small>
    </div>
  <div class="col-md-3">
   <h5 class="text-info">@string.Format("{0:F1}", Model.Grades.Average(g => g.GradeValue))</h5>
        <small class="text-muted">Average Grade</small>
  </div>
 </div>
     </div>
     </div>
       </div>
   }

   <div class="d-flex gap-2">
        <button type="submit" class="btn btn-warning btn-lg">
        <i class="bi bi-save"></i> Update Course
      </button>
       <a asp-action="Courses" class="btn btn-secondary btn-lg">
        <i class="bi bi-arrow-left"></i> Back to Courses
      </a>
   @if (Model.Grades == null || !Model.Grades.Any())
 {
         <a asp-action="DeleteCourse" asp-route-id="@Model.Num" 
      class="btn btn-danger btn-lg"
     onclick="return confirm('Are you sure you want to delete this course?');">
    <i class="bi bi-trash"></i> Delete Course
    </a>
 }
    </div>
         </form>
     </div>
 </div>
  </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
  
    <script>
       document.addEventListener('DOMContentLoaded', function() {
      const maxGradeInput = document.querySelector('input[name="Degree"]');
    const minGradeInput = document.querySelector('input[name="MinDegree"]');

     function validateGrades() {
         const maxGrade = parseFloat(maxGradeInput.value);
     const minGrade = parseFloat(minGradeInput.value);

        if (!isNaN(maxGrade) && !isNaN(minGrade)) {
   if (minGrade >= maxGrade) {
    minGradeInput.setCustomValidity('Minimum grade must be less than maximum grade');
   } else {
       minGradeInput.setCustomValidity('');
      }
     }
      }

   if (maxGradeInput && minGradeInput) {
   maxGradeInput.addEventListener('input', validateGrades);
    minGradeInput.addEventListener('input', validateGrades);
    }
        });
    </script>
}