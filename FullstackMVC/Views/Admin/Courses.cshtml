@model IEnumerable<FullstackMVC.Models.Course>

@{
    ViewData["Title"] = "Manage Courses";
}

<div class="container-fluid mt-4">
    <div class="row">
      <div class="col-12">
    <div class="card shadow">
  <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
        <h2 class="mb-0">
           <i class="bi bi-book-fill"></i> Course Management
  </h2>
    <a asp-action="CreateCourse" class="btn btn-success">
    <i class="bi bi-plus-circle"></i> Add New Course
         </a>
     </div>
        <div class="card-body">
       @if (Model != null && Model.Any())
           {
  <!-- Course Statistics -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
   <div class="card bg-primary text-white">
   <div class="card-body text-center">
      <h3>@Model.Count()</h3>
    <p class="mb-0">Total Courses</p>
      </div>
  </div>
       </div>
   <div class="col-md-3">
   <div class="card bg-success text-white">
       <div class="card-body text-center">
      <h3>@Model.Select(c => c.DeptId).Distinct().Count()</h3>
<p class="mb-0">Departments</p>
  </div>
  </div>
    </div>
   <div class="col-md-3">
      <div class="card bg-info text-white">
    <div class="card-body text-center">
       <h3>@Model.Count(c => c.InstructorId != null)</h3>
        <p class="mb-0">Assigned</p>
       </div>
  </div>
          </div>
      <div class="col-md-3">
    <div class="card bg-warning text-dark">
      <div class="card-body text-center">
          <h3>@string.Format("{0:F0}", Model.Average(c => c.Degree))</h3>
        <p class="mb-0">Avg Max Grade</p>
   </div>
     </div>
       </div>
  </div>

     <!-- Courses Table -->
    <div class="table-responsive">
         <table class="table table-striped table-hover">
   <thead class="table-dark">
      <tr>
 <th>Course #</th>
       <th>Name</th>
    <th>Topic</th>
  <th>Department</th>
      <th>Instructor</th>
         <th>Max Grade</th>
     <th>Min Grade</th>
      <th>Students</th>
       <th>Actions</th>
       </tr>
      </thead>
     <tbody>
         @foreach (var course in Model.OrderBy(c => c.DeptId).ThenBy(c => c.Num))
  {
          var studentCount = course.Grades?.Count() ?? 0;
     var passedCount = course.Grades?.Count(g => g.GradeValue >= course.MinDegree) ?? 0;
        
     <tr>
     <td><strong class="text-primary">@course.Num</strong></td>
      <td>@course.Name</td>
  <td>
 @if (!string.IsNullOrEmpty(course.Topic))
      {
   <span class="badge bg-secondary">@course.Topic</span>
          }
   else
       {
        <span class="text-muted">-</span>
   }
     </td>
        <td>@course.Department?.Name</td>
     <td>
     @if (course.Instructor != null)
 {
       <span class="badge bg-success">@course.Instructor.Name</span>
    }
         else
         {
      <span class="text-muted">Not Assigned</span>
   }
 </td>
         <td><span class="badge bg-info">@course.Degree</span></td>
    <td><span class="badge bg-warning text-dark">@course.MinDegree</span></td>
     <td>
    <div class="d-flex flex-column">
       <span class="badge bg-primary">@studentCount total</span>
        @if (studentCount > 0)
     {
       <small class="text-success">@passedCount passed</small>
          }
   </div>
      </td>
   <td>
      <div class="btn-group" role="group">
   <a asp-action="EditCourse" asp-route-id="@course.Num" 
   class="btn btn-sm btn-warning" title="Edit">
  <i class="bi bi-pencil"></i>
   </a>
    <a asp-action="DeleteCourse" asp-route-id="@course.Num" 
    class="btn btn-sm btn-danger" title="Delete"
     onclick="return confirm('Are you sure you want to delete this course?');">
  <i class="bi bi-trash"></i>
     </a>
 <a asp-action="CourseDetails" asp-route-id="@course.Num" 
    class="btn btn-sm btn-info" title="Details">
    <i class="bi bi-eye"></i>
    </a>
     </div>
  </td>
    </tr>
       }
       </tbody>
   </table>
     </div>
     }
        else
      {
      <div class="text-center py-5">
   <i class="bi bi-book text-muted" style="font-size: 4rem;"></i>
  <h4 class="text-muted mt-3">No Courses Found</h4>
      <p class="text-muted">Click "Add New Course" to create your first course.</p>
          </div>
    }
      </div>
      </div>
   </div>
    </div>
</div>