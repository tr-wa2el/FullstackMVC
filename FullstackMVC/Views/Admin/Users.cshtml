@model IEnumerable<FullstackMVC.Models.ApplicationUser>

@{
    ViewData["Title"] = "Manage Users";
    var userRoles = ViewBag.UserRoles as Dictionary<string, List<string>>;
}

<div class="container mt-4">
    <div class="card shadow">
     <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
      <h2 class="mb-0">User Management</h2>
         <a asp-action="CreateAdmin" class="btn btn-danger">
     <i class="bi bi-shield-plus"></i> Create Admin Account
     </a>
 </div>
        <div class="card-body">
       <div class="alert alert-info">
        <i class="bi bi-info-circle"></i> 
         <strong>Note:</strong> Regular users can only register as Student or Instructor. Admin accounts can only be created here by existing administrators.
       </div>
       
         <div class="table-responsive">
   <table class="table table-striped table-hover">
         <thead class="table-dark">
<tr>
  <th>Username</th>
      <th>Email</th>
   <th>Full Name</th>
          <th>Roles</th>
     <th>Actions</th>
    </tr>
   </thead>
 <tbody>
  @foreach (var user in Model)
{
         <tr>
        <td>@user.UserName</td>
    <td>@user.Email</td>
   <td>@user.FullName</td>
        <td>
         @if (userRoles != null && userRoles.ContainsKey(user.Id))
     {
         @foreach (var role in userRoles[user.Id])
  {
       @if (role == "Admin")
     {
       <span class="badge bg-danger me-1">@role</span>
       }
   else if (role == "Instructor")
          {
         <span class="badge bg-warning text-dark me-1">@role</span>
       }
     else if (role == "Student")
         {
      <span class="badge bg-info me-1">@role</span>
   }
   else
  {
     <span class="badge bg-secondary me-1">@role</span>
     }
  
    <form asp-action="RemoveRole" method="post" style="display:inline;">
  <input type="hidden" name="userId" value="@user.Id" />
   <input type="hidden" name="roleName" value="@role" />
    <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Remove @role role from @user.UserName?');">
   <i class="bi bi-x"></i>
        </button>
     </form>
      }
       }
       else
        {
         <span class="text-muted">No roles</span>
       }
       </td>
    <td>
      <a asp-action="AssignRole" asp-route-userId="@user.Id" class="btn btn-sm btn-success">
       <i class="bi bi-plus-circle"></i> Assign Role
      </a>
   </td>
    </tr>
    }
    </tbody>
  </table>
      </div>
        </div>
    </div>
</div>
