@model IEnumerable<FullstackMVC.Models.Student>

@{
    ViewData["Title"] = "Manage Students";
}

<div class="container-fluid mt-4">
    <div class="row">
  <div class="col-12">
     <div class="card shadow">
      <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
   <h2 class="mb-0">
     <i class="bi bi-people-fill"></i> Student Management
      </h2>
       <a asp-action="CreateStudent" class="btn btn-primary">
   <i class="bi bi-person-plus"></i> Add New Student
  </a>
     </div>
    <div class="card-body">
     @if (Model != null && Model.Any())
     {
      <!-- Student Statistics -->
      <div class="row g-4 mb-4">
   <div class="col-md-3">
  <div class="card bg-primary text-white">
     <div class="card-body text-center">
     <h3>@Model.Count()</h3>
    <p class="mb-0">Total Students</p>
 </div>
     </div>
  </div>
     <div class="col-md-3">
  <div class="card bg-success text-white">
     <div class="card-body text-center">
  <h3>@Model.Select(s => s.DeptId).Distinct().Count()</h3>
    <p class="mb-0">Departments</p>
    </div>
      </div>
     </div>
     <div class="col-md-3">
        <div class="card bg-info text-white">
      <div class="card-body text-center">
      <h3>@string.Format("{0:F1}", Model.Average(s => s.Age))</h3>
     <p class="mb-0">Average Age</p>
    </div>
      </div>
     </div>
     <div class="col-md-3">
  <div class="card bg-warning text-dark">
   <div class="card-body text-center">
    <h3>@Model.Count(s => s.Grades != null && s.Grades.Any())</h3>
       <p class="mb-0">With Grades</p>
     </div>
       </div>
     </div>
    </div>

        <!-- Students Table -->
<div class="table-responsive">
     <table class="table table-striped table-hover">
      <thead class="table-dark">
      <tr>
     <th>SSN</th>
    <th>Name</th>
       <th>Age</th>
       <th>Gender</th>
      <th>Department</th>
<th>Enrolled Courses</th>
       <th>Average Grade</th>
    <th>Actions</th>
    </tr>
      </thead>
  <tbody>
     @foreach (var student in Model.OrderBy(s => s.DeptId).ThenBy(s => s.Name))
       {
  var enrolledCourses = student.Grades?.Count() ?? 0;
     var avgGrade = student.Grades?.Any() == true ? student.Grades.Average(g => g.GradeValue) : 0;
   var passedCourses = student.Grades?.Count(g => g.GradeValue >= g.Course.MinDegree) ?? 0;
     
     <tr>
       <td><strong class="text-primary">@student.SSN</strong></td>
      <td>
   <div class="d-flex align-items-center">
     @if (!string.IsNullOrEmpty(student.Image))
      {
       <img src="@student.Image" alt="Profile" class="rounded-circle me-2" 
     style="width: 32px; height: 32px; object-fit: cover;"
      onerror="this.src='https://via.placeholder.com/32x32?text=👤';" />
      }
    else
      {
     <div class="rounded-circle me-2 bg-secondary d-flex align-items-center justify-content-center" 
        style="width: 32px; height: 32px;">
    <i class="bi bi-person text-white"></i>
     </div>
      }
     @student.Name
        </div>
       </td>
    <td>@student.Age years</td>
    <td>
   @if (student.Gender == "Male")
     {
     <span class="badge bg-primary">Male</span>
      }
    else
    {
       <span class="badge bg-pink">Female</span>
     }
 </td>
       <td>@student.Department?.Name</td>
   <td>
      <span class="badge bg-info">@enrolledCourses</span>
   @if (enrolledCourses > 0)
      {
       <small class="text-success d-block">@passedCourses passed</small>
    }
     </td>
<td>
        @if (enrolledCourses > 0)
       {
         <span class="badge bg-success">@string.Format("{0:F1}", avgGrade)</span>
    }
   else
      {
      <span class="text-muted">No grades</span>
      }
     </td>
       <td>
    <div class="btn-group" role="group">
 <a asp-action="EditStudent" asp-route-id="@student.SSN" 
     class="btn btn-sm btn-warning" title="Edit">
      <i class="bi bi-pencil"></i>
        </a>
     <a asp-action="DeleteStudent" asp-route-id="@student.SSN" 
        class="btn btn-sm btn-danger" title="Delete"
      onclick="return confirm('Are you sure you want to delete this student?');">
      <i class="bi bi-trash"></i>
     </a>
    <a asp-action="StudentDetails" asp-route-id="@student.SSN" 
   class="btn btn-sm btn-info" title="Details">
    <i class="bi bi-eye"></i>
  </a>
     </div>
      </td>
     </tr>
 }
    </tbody>
      </table>
 </div>
    }
     else
       {
   <div class="text-center py-5">
        <i class="bi bi-people text-muted" style="font-size: 4rem;"></i>
     <h4 class="text-muted mt-3">No Students Found</h4>
      <p class="text-muted">Click "Add New Student" to create your first student record.</p>
     </div>
    }
      </div>
    </div>
  </div>
    </div>
</div>

<style>
.bg-pink {
    background-color: #e83e8c !important;
}
</style>