@model IEnumerable<FullstackMVC.Models.Grade>

@{
    ViewData["Title"] = "Course Students";
    var course = ViewBag.Course as FullstackMVC.Models.Course;
}

<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
          <h1 class="mb-4">
<i class="bi bi-people-fill"></i> Students in @course?.Name
  </h1>
        </div>
    </div>

    <!-- Course Info -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
         <div class="card-body">
           <div class="row align-items-center">
         <div class="col-md-8">
       <h5 class="mb-1">@course?.Name</h5>
          <p class="text-muted mb-0">
     <strong>Course Code:</strong> @course?.Num | 
        <strong>Department:</strong> @course?.Department?.Name |
      <strong>Max Grade:</strong> @course?.Degree |
     <strong>Min Grade:</strong> @course?.MinDegree
       </p>
          </div>
             <div class="col-md-4 text-end">
           <a asp-action="AddGrade" asp-route-courseId="@course?.Num" class="btn btn-success">
               <i class="bi bi-plus-circle"></i> Add New Grade
          </a>
          </div>
     </div>
                </div>
   </div>
  </div>
    </div>

    @if (Model != null && Model.Any())
    {
    <!-- Statistics -->
        <div class="row g-4 mb-4">
    <div class="col-md-3">
     <div class="card bg-primary text-white shadow">
   <div class="card-body text-center">
   <i class="bi bi-people" style="font-size: 2rem; opacity: 0.7;"></i>
         <h4 class="mt-2">@Model.Count()</h4>
       <p class="mb-0">Total Students</p>
       </div>
                </div>
            </div>
            <div class="col-md-3">
    <div class="card bg-success text-white shadow">
       <div class="card-body text-center">
               <i class="bi bi-check-circle" style="font-size: 2rem; opacity: 0.7;"></i>
     <h4 class="mt-2">@Model.Count(g => g.GradeValue >= course.MinDegree)</h4>
                 <p class="mb-0">Passed</p>
  </div>
      </div>
  </div>
   <div class="col-md-3">
     <div class="card bg-danger text-white shadow">
        <div class="card-body text-center">
   <i class="bi bi-x-circle" style="font-size: 2rem; opacity: 0.7;"></i>
   <h4 class="mt-2">@Model.Count(g => g.GradeValue < course.MinDegree)</h4>
           <p class="mb-0">Failed</p>
     </div>
            </div>
          </div>
       <div class="col-md-3">
     <div class="card bg-info text-white shadow">
          <div class="card-body text-center">
           <i class="bi bi-graph-up" style="font-size: 2rem; opacity: 0.7;"></i>
           <h4 class="mt-2">@string.Format("{0:F1}", Model.Average(g => g.GradeValue))</h4>
          <p class="mb-0">Average Grade</p>
    </div>
     </div>
          </div>
     </div>

     <!-- Students Table -->
        <div class="row">
   <div class="col-12">
      <div class="card shadow">
        <div class="card-header bg-dark text-white">
        <h4 class="mb-0">
     <i class="bi bi-table"></i> Student Grades
              </h4>
   </div>
        <div class="card-body">
     <div class="table-responsive">
<table class="table table-hover">
  <thead class="table-dark">
        <tr>
        <th>Student SSN</th>
          <th>Student Name</th>
     <th>Grade</th>
   <th>Percentage</th>
      <th>Status</th>
   <th>Actions</th>
        </tr>
           </thead>
      <tbody>
      @foreach (var grade in Model.OrderByDescending(g => g.GradeValue))
      {
   var percentage = (grade.GradeValue / course.Degree) * 100;
          var isPassed = grade.GradeValue >= course.MinDegree;
         
   <tr class="@(isPassed ? "" : "table-warning")">
<td><strong>@grade.Student?.SSN</strong></td>
        <td>@grade.Student?.Name</td>
          <td>
       <span class="badge @(isPassed ? "bg-success" : "bg-danger") fs-6">
         @grade.GradeValue / @course?.Degree
       </span>
       </td>
              <td>
 <div class="progress" style="height: 20px; min-width: 100px;">
       <div class="progress-bar @(isPassed ? "bg-success" : "bg-danger")" 
    role="progressbar" 
          style="width: @percentage%" 
          aria-valuenow="@percentage" 
     aria-valuemin="0" 
        aria-valuemax="100">
               @string.Format("{0:F1}%", percentage)
       </div>
    </div>
      </td>
 <td>
    @if (isPassed)
                  {
            <span class="badge bg-success">
        <i class="bi bi-check-circle"></i> Passed
    </span>
      }
  else
        {
            <span class="badge bg-danger">
          <i class="bi bi-x-circle"></i> Failed
            </span>
       }
        </td>
      <td>
       <a asp-action="EditGrade" asp-route-id="@grade.Id" 
             class="btn btn-sm btn-warning" title="Edit Grade">
   <i class="bi bi-pencil"></i>
           </a>
  </td>
     </tr>
      }
              </tbody>
      </table>
            </div>
        </div>
     </div>
            </div>
        </div>

        <!-- Grade Distribution Chart (Simple) -->
     <div class="row mt-4">
            <div class="col-12">
                <div class="card shadow">
               <div class="card-header bg-secondary text-white">
          <h5 class="mb-0"><i class="bi bi-bar-chart"></i> Grade Distribution</h5>
            </div>
            <div class="card-body">
             <div class="row text-center">
  <div class="col-md-2">
             <h4 class="text-success">@Model.Count(g => g.GradeValue >= 90)</h4>
               <small class="text-muted">A (90-100)</small>
                </div>
           <div class="col-md-2">
     <h4 class="text-info">@Model.Count(g => g.GradeValue >= 80 && g.GradeValue < 90)</h4>
       <small class="text-muted">B (80-89)</small>
              </div>
          <div class="col-md-2">
         <h4 class="text-warning">@Model.Count(g => g.GradeValue >= 70 && g.GradeValue < 80)</h4>
       <small class="text-muted">C (70-79)</small>
      </div>
          <div class="col-md-2">
    <h4 class="text-orange">@Model.Count(g => g.GradeValue >= 60 && g.GradeValue < 70)</h4>
       <small class="text-muted">D (60-69)</small>
    </div>
   <div class="col-md-2">
   <h4 class="text-danger">@Model.Count(g => g.GradeValue < 60)</h4>
       <small class="text-muted">F (0-59)</small>
       </div>
      <div class="col-md-2">
     <h4 class="text-primary">@string.Format("{0:F1}%", ((double)Model.Count(g => g.GradeValue >= course.MinDegree) / Model.Count()) * 100)</h4>
      <small class="text-muted">Pass Rate</small>
        </div>
     </div>
            </div>
      </div>
         </div>
     </div>
    }
    else
    {
        <!-- No Students -->
  <div class="row">
    <div class="col-12">
      <div class="card shadow text-center">
          <div class="card-body py-5">
                <i class="bi bi-people text-muted" style="font-size: 5rem;"></i>
   <h3 class="mt-3 text-muted">No Students Enrolled</h3>
        <p class="text-muted">There are no students enrolled in this course yet.</p>
<a asp-action="AddGrade" asp-route-courseId="@course?.Num" class="btn btn-success btn-lg">
          <i class="bi bi-plus-circle"></i> Add First Student Grade
                      </a>
    </div>
              </div>
            </div>
        </div>
    }

    <!-- Quick Actions -->
    <div class="row mt-4">
        <div class="col-12">
  <div class="card shadow">
     <div class="card-header bg-light">
         <h5 class="mb-0">Quick Actions</h5>
      </div>
       <div class="card-body">
      <div class="d-flex flex-wrap gap-2">
      <a asp-action="MyCourses" class="btn btn-outline-primary">
       <i class="bi bi-arrow-left"></i> Back to My Courses
        </a>
         <a asp-action="AddGrade" asp-route-courseId="@course?.Num" class="btn btn-outline-success">
         <i class="bi bi-plus-circle"></i> Add Grade
        </a>
       <a asp-action="Dashboard" class="btn btn-outline-secondary">
     <i class="bi bi-speedometer2"></i> Dashboard
           </a>
       </div>
    </div>
   </div>
   </div>
    </div>
</div>

<style>
.text-orange {
    color: #fd7e14 !important;
}
</style>